<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cinema Sala</title>

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
margin:0;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.container{
background:#111;
padding:20px;
border-radius:15px;
width:350px;
box-shadow:0 0 20px rgba(0,255,200,0.3);
}

input,button{
width:100%;
padding:8px;
margin:6px 0;
border:none;
border-radius:8px;
}

button{
background:#00ffcc;
font-weight:bold;
cursor:pointer;
}

.link{
color:#00ffcc;
cursor:pointer;
text-align:center;
display:block;
margin-top:10px;
}

.hidden{display:none}

/* AREA SALA */
#areaSala{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
flex-direction:column;
align-items:center;
padding:20px;
overflow:auto;
}

#player{
width:90%;
max-width:900px;
margin-top:10px;
border-radius:10px;
}

/* CHAT FLUTUANTE */

#chatBox{
position:fixed;
bottom:15px;
right:15px;
width:280px;
background:#111;
border-radius:15px;
box-shadow:0 0 15px #00ffcc;
overflow:hidden;
}

#chatHeader{
background:#00ffcc;
color:black;
padding:10px;
cursor:pointer;
font-weight:bold;
}

#chatMessages{
height:220px;
overflow-y:auto;
padding:10px;
font-size:13px;
}

#chatInput{
display:flex;
}

#chatInput input{
flex:1;
border-radius:0;
}

#chatInput button{
width:70px;
border-radius:0;
}

.minimized #chatMessages,
.minimized #chatInput{
display:none;
}
</style>
</head>
<body>

<!-- CADASTRO -->
<div class="container" id="registerBox">
<h2>Criar Conta</h2>
<input type="email" id="registerEmail" placeholder="Email">
<input type="password" id="registerPassword" placeholder="Senha">
<button onclick="registrar()">Registrar</button>
<span class="link" onclick="mostrarLogin()">Já tem conta? Entrar</span>
</div>

<!-- LOGIN -->
<div class="container hidden" id="loginBox">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Senha">
<button onclick="login()">Entrar</button>
<span class="link" onclick="mostrarCadastro()">Criar conta</span>
</div>

<!-- AREA PRIVADA -->
<div class="container hidden" id="areaPrivada">
<h3>Criar Sala</h3>
<input type="text" id="nomeSala" placeholder="Nome da sala">
<button onclick="criarSala()">Criar Sala</button>
<p id="msgSala" style="color:lime;"></p>

<hr>

<h3>Entrar Sala</h3>
<input type="text" id="codigoSala" placeholder="KEY da sala">
<button onclick="entrarSala()">Entrar</button>
</div>

<!-- AREA SALA -->
<div id="areaSala" class="hidden">
<h2 id="nomeSalaView"></h2>

<input type="file" id="videoGaleria" accept="video/*">
<input type="text" id="linkVideo" placeholder="Link direto .mp4">

<button onclick="carregarVideo()">Carregar Vídeo</button>

<video id="player" controls></video>

<br>
<button onclick="sairSala()">Sair da Sala</button>
</div>

<!-- CHAT FLUTUANTE -->
<div id="chatBox" class="hidden">
<div id="chatHeader" onclick="toggleChat()"> Chat</div>
<div id="chatMessages"></div>
<div id="chatInput">
<input type="text" id="msgInput" placeholder="Mensagem">
<button onclick="enviarMsg()">Enviar</button>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE",
  messagingSenderId: "SEU_MSG_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let salaAtual = null;

/* LOGIN */

window.mostrarLogin=()=>{registerBox.classList.add("hidden");loginBox.classList.remove("hidden")}
window.mostrarCadastro=()=>{loginBox.classList.add("hidden");registerBox.classList.remove("hidden")}

window.registrar=()=>{
createUserWithEmailAndPassword(auth,registerEmail.value,registerPassword.value)
.catch(e=>alert(e.message))
}

window.login=()=>{
signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value)
.catch(e=>alert(e.message))
}

onAuthStateChanged(auth,user=>{
if(user){
registerBox.classList.add("hidden")
loginBox.classList.add("hidden")
areaPrivada.classList.remove("hidden")
}else{
areaPrivada.classList.add("hidden")
registerBox.classList.remove("hidden")
}
})

/* SALA */

window.criarSala=async()=>{
if(!nomeSala.value) return alert("Digite nome da sala")
const key=Math.random().toString(36).substring(2,8).toUpperCase()
await setDoc(doc(db,"salas",key),{
nome:nomeSala.value,
key:key
})
msgSala.innerText=" Sala criada! KEY: "+key
}

window.entrarSala=async()=>{
const snap=await getDoc(doc(db,"salas",codigoSala.value))
if(snap.exists()){
salaAtual=codigoSala.value
areaPrivada.classList.add("hidden")
areaSala.classList.remove("hidden")
chatBox.classList.remove("hidden")
nomeSalaView.innerText="Sala: "+snap.data().nome
iniciarChat()
}else alert("Sala não encontrada")
}

window.sairSala=()=>{
areaSala.classList.add("hidden")
areaPrivada.classList.remove("hidden")
chatBox.classList.add("hidden")
player.src=""
}

/* VIDEO */

window.carregarVideo=()=>{
if(videoGaleria.files[0]){
player.src=URL.createObjectURL(videoGaleria.files[0])
player.play()
}else if(linkVideo.value){
player.src=linkVideo.value
player.play()
}else{
alert("Coloque vídeo da galeria ou link")
}
}

/* CHAT */

window.toggleChat=()=>{
chatBox.classList.toggle("minimized")
}

window.enviarMsg=async()=>{
if(!msgInput.value) return
await addDoc(collection(db,"salas",salaAtual,"chat"),{
user:auth.currentUser.email,
msg:msgInput.value,
time:new Date()
})
msgInput.value=""
}

function iniciarChat(){
const q=query(collection(db,"salas",salaAtual,"chat"),orderBy("time"))
onSnapshot(q,snap=>{
chatMessages.innerHTML=""
snap.forEach(doc=>{
chatMessages.innerHTML+=`<div><b>${doc.data().user}:</b> ${doc.data().msg}</div>`
})
chatMessages.scrollTop=chatMessages.scrollHeight
})
}

</script>

</body>
</html>
