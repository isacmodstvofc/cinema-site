<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rede Privada</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#141e30,#243b55);
    color:white;
}

.criador{
    text-align:center;
    padding:15px;
    font-size:14px;
    background:rgba(0,0,0,0.4);
}

.criador a{
    color:#00ffcc;
    text-decoration:none;
    font-weight:bold;
}

.hidden{display:none;}

.container{
    width:90%;
    max-width:400px;
    margin:40px auto;
    background:#1c1c1c;
    padding:25px;
    border-radius:12px;
}

input{
    width:100%;
    padding:10px;
    margin:8px 0;
    border:none;
    border-radius:6px;
}

button{
    padding:10px;
    border:none;
    border-radius:6px;
    background:#00ffcc;
    font-weight:bold;
    cursor:pointer;
}

.menu{
    padding:15px;
    background:#000;
    display:flex;
    align-items:center;
    gap:10px;
}

.menu img{
    width:45px;
    height:45px;
    border-radius:50%;
    object-fit:cover;
}

.feed{
    padding:15px;
    max-width:600px;
    margin:auto;
}

.post{
    background:#1c1c1c;
    padding:15px;
    border-radius:12px;
    margin-bottom:20px;
}

.post img,.post video,.post iframe{
    width:100%;
    border-radius:10px;
    margin-top:10px;
    max-height:500px;
}

.chat-box{
    background:#111;
    border-radius:12px;
    padding:10px;
    margin-top:10px;
    max-height:300px;
    display:flex;
    flex-direction:column;
}

.chat-mensagens{
    flex:1;
    overflow-y:auto;
    margin-bottom:10px;
    font-size:14px;
}

.chat-msg{
    margin-bottom:6px;
    padding:6px;
    background:#1c1c1c;
    border-radius:6px;
}
</style>
</head>
<body>

<div class="criador">
Criador do site: <b>Isac Santos de Freitas</b><br>
Instagram: <a href="https://instagram.com/nini.vuhh" target="_blank">@nini.vuhh</a>
</div>

<!-- REGISTRO -->
<div class="container" id="registerBox">
<h2>Criar Conta</h2>
<input type="text" id="regNome" placeholder="Seu nome">
<input type="file" id="regFoto" accept="image/*">
<input type="text" id="regKey" placeholder="Crie sua Key">
<button onclick="registrar()">Registrar</button>
<p>Já tem conta? 
<span onclick="mostrarLogin()" style="color:#00ffcc;cursor:pointer;">Entrar</span>
</p>
</div>

<!-- LOGIN -->
<div class="container hidden" id="loginBox">
<h2>Login</h2>
<input type="text" id="loginKey" placeholder="Digite sua Key">
<button onclick="login()">Entrar</button>
</div>

<!-- AREA PRIVADA -->
<div class="hidden" id="privado">

<div class="menu">
<img id="perfilFoto">
<div id="perfilNome"></div>
<button style="margin-left:auto;background:red;color:white;" onclick="logout()">Sair</button>
</div>

<div class="feed">

<h3>Nova Publicação</h3>
<input type="file" id="fileInput" accept="image/*,video/*">
<input type="text" id="linkInput" placeholder="Ou cole um link">
<button onclick="postar()">Postar</button>
<hr>

<div id="posts"></div>

<h3>Chat da Sala</h3>
<div class="chat-box">
<div class="chat-mensagens" id="chatBox"></div>
<input type="text" id="chatInput" placeholder="Digite mensagem">
<button onclick="enviarMensagem()">Enviar</button>
</div>

</div>
</div>

<script>

let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
let salas = JSON.parse(localStorage.getItem("salas")) || {};
let usuarioLogado = null;

function salvar(){
localStorage.setItem("usuarios",JSON.stringify(usuarios));
localStorage.setItem("salas",JSON.stringify(salas));
}

function mostrarLogin(){
registerBox.classList.add("hidden");
loginBox.classList.remove("hidden");
}

function registrar(){
let nome = regNome.value.trim();
let key = regKey.value.trim();
let foto = regFoto.files[0];

if(!nome || !key || !foto){
alert("Preencha tudo");
return;
}

if(usuarios.find(u=>u.key===key)){
alert("Key já existe");
return;
}

let reader = new FileReader();
reader.onload = function(e){

let novoUsuario = {
nome:nome,
key:key,
foto:e.target.result
};

usuarios.push(novoUsuario);
salas[key]={posts:[],chat:[]};
salvar();

alert("Registrado com sucesso!");
mostrarLogin();
}

reader.readAsDataURL(foto);
}

function login(){
let key = loginKey.value.trim();
let usuario = usuarios.find(u=>u.key===key);

if(!usuario){
alert("Key inválida");
return;
}

usuarioLogado=usuario;

perfilNome.innerHTML = usuario.nome + "<br><small>Rede criada por Isac Santos</small>";
perfilFoto.src = usuario.foto;

loginBox.classList.add("hidden");
registerBox.classList.add("hidden");
privado.classList.remove("hidden");

carregarPosts();
carregarChat();
}

function postar(){
let sala = salas[usuarioLogado.key];
let file = fileInput.files[0];
let link = linkInput.value.trim();

if(!file && !link){
alert("Escolha arquivo ou link");
return;
}

let conteudo={};

if(file){
conteudo.tipo = file.type.startsWith("image") ? "img":"video";
conteudo.src = URL.createObjectURL(file);
}

if(link){
conteudo.tipo="link";
conteudo.src=link;
}

sala.posts.push(conteudo);
salvar();
carregarPosts();
fileInput.value="";
linkInput.value="";
}

function carregarPosts(){
let sala = salas[usuarioLogado.key];
posts.innerHTML="";

sala.posts.slice().reverse().forEach(p=>{
let div=document.createElement("div");
div.className="post";

if(p.tipo==="img"){
let img=document.createElement("img");
img.src=p.src;
div.appendChild(img);
}

if(p.tipo==="video"){
let video=document.createElement("video");
video.src=p.src;
video.controls=true;
div.appendChild(video);
}

if(p.tipo==="link"){
let a=document.createElement("a");
a.href=p.src;
a.target="_blank";
a.style.color="#00ffcc";
a.innerText="Abrir Link";
div.appendChild(a);
}

posts.appendChild(div);
});
}

function enviarMensagem(){
let texto = chatInput.value.trim();
if(!texto) return;

let sala = salas[usuarioLogado.key];
sala.chat.push({nome:usuarioLogado.nome,texto:texto});
salvar();
chatInput.value="";
carregarChat();
}

function carregarChat(){
let sala = salas[usuarioLogado.key];
chatBox.innerHTML="";

sala.chat.forEach(msg=>{
let div=document.createElement("div");
div.className="chat-msg";
div.innerHTML="<b>"+msg.nome+":</b> "+msg.texto;
chatBox.appendChild(div);
});

chatBox.scrollTop=chatBox.scrollHeight;
}

function logout(){
usuarioLogado=null;
privado.classList.add("hidden");
loginBox.classList.remove("hidden");
}

</script>
</body>
</html>
